#!/bin/bash

path='/mnt/d/prakhar/hacking/tools/wordlists/quick/'

subdomain_enum(){
    printf "\n" && echo -e "\e[32mSubdomain Enumeration Started at $target, This may take sometime...\e[0m"
    printf "\n" && echo "ğ™´ğš—ğšğš–ğšğš›ğšŠğšğš’ğš—ğš ğšğšœğš’ğš—ğš ğšŠğš–ğšŠğšœğšœ..."
    amass enum -passive -d $target | tee -a subdomains.txt >/dev/null
    printf "\n" && echo "ğ™´ğš—ğšğš–ğšğš›ğšŠğšğš’ğš—ğš ğšğšœğš’ğš—ğš ğš‚ğšğš‹ğšğš’ğš—ğšğšğš›..."
    subfinder -d $target -silent | tee -a subdomains.txt >/dev/null
    printf "\n" && echo "ğ™´ğš—ğšğš–ğšğš›ğšŠğšğš’ğš—ğš ğšğšœğš’ğš—ğš ğšŒğš›ğš.ğšœğš‘..."
    curl -s https://crt.sh/\?q\=%25.$target\&output\=json | jq -r .[].name_value | sed 's/\*\.//g' | sort -u | tee -a subdomains.txt >/dev/null
    cat subdomains.txt | sort -u > hosts.txt
    printf "\n" && echo "ğ™µğš’ğš•ğšğšğš›ğš’ğš—ğš ğ™»ğš’ğšŸğš ğš‚ğšğš‹ğšğš˜ğš–ğšŠğš’ğš—ğšœ..."
    cat hosts.txt | httpx -silent -sc -title | tee -a livedomains.txt >/dev/null && rm subdomains.txt
    echo "" && echo "ğ™³ğš˜ğš—ğš..." && printf "\n"
}

dir_bruteforce(){
    printf "\n"
    echo -e "\e[32mDirectory Bruteforcing Started at $target\e[0m"
    dirsearch -u $target -w /mnt/d/prakhar/hacking/tools/wordlists/quick/quick.txt -x 400,404
    echo "" && echo "ğ™³ğš˜ğš—ğš..." && printf "\n"
}

port_scan(){
    printf "\n" && echo -e "\e[32mPort Scanning Started at $target\e[0m"
    nmap -Pn -vv -p 21,80,139,443,445,1099,2082,2083,3000,4243,5000,8443,8000,8080,8081,8089,8084,8088,8888,9090,9443,10000 $target | grep -E 'open|closed'
    echo "" && echo "ğ™³ğš˜ğš—ğš..." && printf "\n"
}

# Just a Python Resolver
resolve_subdomains(){
    echo -e "\e[32mResolving Subdomains (Finding IPs)...\e[0m"
    python3 - <<END
import socket
import time
import os

        # Resolving DNS
def resolve_dns(hostname):
    try:
        ip_address = socket.gethostbyname(hostname)
        return ip_address
    except socket.gaierror as e:
        return None


filename = "hosts.txt"
if os.path.exists(filename):
    print("Well all good..!!\n")
else:
    print("Oops..!!, {filename} does not Exists..!!\n")
    quit()
output_filename = "ips.txt"

with open(filename, 'r') as file,open(output_filename, 'w') as output:
    print("\n\033[1;32m [STATUS] ğš‚ğšğšŠğš›ğšğšğš ğšğšğšœğš˜ğš•ğšŸğš’ğš—ğš ğšŠğš : \033[0m",time.strftime("%Y-%m-%d %H:%M:%S"))
    iteration = 0

    for subdomain in file:
        iteration = iteration+1
        subdomain = subdomain.strip()
        ip_address = resolve_dns(subdomain)

        if(ip_address != None):
            print(f"\033[1;31m {subdomain} \033[0m :: \033[1;32m {ip_address} \033[0m")
            output.write(f"{subdomain} : {ip_address}\n")

        if(iteration % 500 == 0):
            print(f"\033[1;34m\n[STATUS] TOTAL {iteration} subdomains Resolved\033[0m")


print("\n\033[1;32m[STATUS] ğš‚ğšğšŒğšŒğšğšœğšœğšğšğš•ğš•ğš¢ ğšğšğšœğš˜ğš•ğšŸğšğš ğšŠğš :: \033[0m",time.strftime("%Y-%m-%d %H:%M:%S"))
print("\n\033[1;32m[STATUS] ğšğšğšœğš˜ğš•ğšŸğšğš ğš‘ğš˜ğšœğšğšœ ğšœğšŠğšŸğšğš ğš’ğš—ğšğš˜ : \033[1;31mresolvers.txt\033[0m\n\n")
END
}

fresh_up(){
    printf "\n" && echo -e "\e[32mğš„ğš™ğšğšŠğšğš’ğš—ğš ğšœğš¢ğšœğšğšğš–...\e[0m"
    apt update && apt upgrade -y && apt clean
    echo "" && echo "ğ™³ğš˜ğš—ğš..." && printf "\n"
}


#Banner
printf "\n\n\n"
printf "\t â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—\n"
printf "\tâ–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘\n"
printf "\tâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘\n"
printf "\tâ–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘\n"
printf "\tâ–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘\n"
printf "\tâ•šâ•â•  â•šâ•â•â•šâ•â•     â•šâ•â•     â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â•â•šâ•â•  â•šâ•â•\n"
echo -e "                                       By ~ \e[32mGhostğŸ’€ aka Prakhar Porwal\e[0m" && echo ""



# Other Tasks functions

if [ $# -lt 2 ]; then
    echo "" && echo -e "        Usage: \e[33m$0 [options] <target>\e[0m"
    printf "\tOptions:\n"
    printf "\t  -sb     Subdomain Enumeration\n"
    printf "\t  -D      Normal Directory Bruteforcing\n"
    printf "\t  -ps     Port Scanning\n"
    printf "\t  -r      Resolving subdomains\n"
    printf "\t  -fresh  Fresh-up Everything\n\n"
    exit 1
fi


target="${@: -1}"  # Get the last argument as the target

# Parse flags and options
flags=()

for arg in "${@:1:$#-1}"; do
    case $arg in
        -sb|-D|-ps|-r|-fresh|-h)
            flags+=("$arg")
            ;;
        *)
            usage
            exit 1
            ;;
    esac
done

# Handle the parsed flags and options
for flag in "${flags[@]}"; do
    case $flag in
        -sb)
            subdomain_enum
            ;;
        -D)
            dir_bruteforce
            ;;
        -ps)
            port_scan
            ;;
        -r)
            resolve_subdomains
            ;;
        -fresh)
            fresh_up
            ;;
    esac
done
